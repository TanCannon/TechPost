{% extends "layout.html" %}


{% set fname =  "assets/img/default-thumbnail.jpg" %}
{% set ftitle =  "ASCII Tree to Folder | Generate & Download ZIP Online" %}
{% set fdescription =  "Easily convert ASCII tree structures into real folders and download them as ZIP files. Fast, simple, and efficient folder generator tool online." %}
{% set ftagline =  "Turn ASCII trees into real folders, download instantly as ZIP." %}


{% block title %}
{{ftitle}}
{% endblock %}

{% block meta_description %}
{{fdescription}}
{% endblock %}

{% block og_title %}{{ftitle}}{% endblock %}
{% block og_description %}{{ fdescription }}{% endblock %}
{% block og_image %}{{ url_for('static',filename=fname, _external=True)}}{% endblock %}

{% block twitter_title %}{{ ftitle }}{% endblock %}
{% block twitter_description %}{{ fdescription }}{% endblock %}
{% block twitter_image %}{{ url_for('static',filename=fname,  _external=True)}}{% endblock %}

{% block page_style %}
{{url_for('static', filename='css/generateZip.css')}}
{% endblock page_style %}

{%block add_headers%} 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/theme/material.css" media="print" onload="this.media='all'">

<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/javascript/javascript.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/addon/display/placeholder.js" defer></script>

{% endblock %}

{% block body %}
   <header class="masthead" style="background-image: url('{{url_for('static', filename='assets/img/home-bg.jpg')}}')">
    <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <!-- <h1>Man must explore, and this is exploration at its greatest</h1> -->
                            <!-- i accssing these lines from python file in post_rout() -->
                            <h1>{{ftitle}}</h1>
                            <h2 class="subheading">{{ftagline}}</h2>
                        </div>
                    </div>
                </div>
            </div>
   </header>
    <!--main content-->
    <div id="dualeditor">
        <div class="editor">
            <div class="editor-label">
                <span>Unicode Style</span>
                <button class="copy-btn" data-target="unicodeEditor">Copy</button>
            </div>
            <div id="unicodeEditor" class="autoresizeeditor"></div>
        </div>

        <div class="editor">
            <div class="editor-label">
                <span>ASCII Style</span>
                <button class="copy-btn" data-target="asciiEditor">Copy</button>
            </div>
            <div id="asciiEditor" class="autoresizeeditor"></div>
        </div>
    </div>
    <div class="center-content-h">
        <form id="treeForm" method="POST" action="/ascii-tree-to-zip">
                        <!-- hidden input where we put editor content -->
                        <textarea id="unicodeHidden" name="unicodeContent" hidden></textarea>
                        <button type="submit" id="submit-btn" class="btn btn-primary">Generate ZIP</button>
        </form>
    </div>
    <div class="center-content-h" id="center-user-guide">
        <section id="quick-start" class="editor-help">
            <p class="blurb">
                <strong>Quick Start:</strong>
                Type your folder tree in the <em>ASCII editor</em> (keyboard symbols: <code>|</code>, <code>-</code>, <code>`</code>)
                or paste an existing Unicode tree in the <em>Unicode editor</em>. Both editors sync and preview each other.
                When ready, click <strong>Generate ZIP</strong> to download your folder structure as real folders.
            </p>
        </section>

        <section id="detailed-guide" class="editor-help">
            <h2>How to Use the Editors</h2>
            <p>This platform provides <strong>two editors</strong> to help you create, paste, or edit folder tree structures and convert them into real folders.</p>

            <h3>1. ASCII Editor (Recommended)</h3>
            <p>Use the ASCII editor if you are <strong>typing</strong> your folder structure. It supports only symbols available on your keyboard: <code>|</code>, <code>-</code>, <code>`</code>.</p>
            <pre aria-label="ASCII example" class="example">
            project/
            |-- src/
            |   |-- main.py
            |   `-- utils.py
            `-- README.md</pre>

            <h3>2. Unicode Editor</h3>
            <p>Use the Unicode editor if you are <strong>pasting</strong> a folder structure written with Unicode tree symbols.</p>
            <pre aria-label="Unicode example" class="example">
            project/
            ‚îú‚îÄ docs/
            ‚îú‚îÄ src/
            ‚îÇ  ‚îú‚îÄ main.py
            ‚îÇ  ‚îî‚îÄ utils.py
            ‚îî‚îÄ README.md</pre>

            <h3>3. Edit in Either Format</h3>
            <p>Both editors are <strong>linked</strong>: you can type in ASCII and see the Unicode preview, or paste in Unicode and refine it in ASCII.</p>

            <h3>4. Generate and Download</h3>
            <p>Review your structure for accuracy. Click <strong>‚ÄúGenerate ZIP‚Äù</strong> to create and download your folder structure as a real, ready-to-use ZIP file.</p>

            <p class="pro-tip"><strong>üí° Pro Tip:</strong> Use this tool in your documentation or workflow to quickly turn ASCII or Unicode folder trees into real project folders‚Äîperfect for sharing setups, tutorials, or boilerplates.</p>
        </section>
    </div>

<script>
    function unicodeToAscii(text) {
        return text
        .replace(/‚îú‚îÄ/g, "|--")
        .replace(/‚îî‚îÄ/g, "`--")
        .replace(/‚îÇ/g, "|");
    }

    function asciiToUnicode(text) {
        return text
        .replace(/(\|--)/g, "‚îú‚îÄ")
        .replace(/`--/g, "‚îî‚îÄ")
        .replace(/\|/g, "‚îÇ");
    }

    function debounce(fn, delay) {
        let timer;
        return function(...args) {
            clearTimeout(timer);
            timer = setTimeout(() => fn.apply(this, args), delay);
        };
    }

    //wrapping inside window event to wait for js for CodeMirror to load.    
    window.addEventListener("DOMContentLoaded", () => {
        // Create editors
        const unicodeBox = CodeMirror(document.getElementById("unicodeEditor"), {
            lineNumbers: true,
            lineWrapping: true,
            mode: "text/plain",
            theme: "material",
            value: "",
            placeholder: "‚îú‚îÄ, ‚îî‚îÄ, ‚îÇ style tree..."
        });

        const asciiBox = CodeMirror(document.getElementById("asciiEditor"), {
            lineNumbers: true,
            lineWrapping: true,
            mode: "text/plain",
            theme: "material",
            value: "",
            placeholder: "|--, `-- style tree..."
        });

            // Mirror cursor between editors
        function mirrorCursor(source, target) {
            const cursor = source.getCursor();
            target.setCursor(cursor);
        }

        const handleUnicode = debounce((instance, changeObj) => {
        // Ignore internal updates caused by setValue
        if (changeObj.origin === "setValue") return;

        const text = unicodeBox.getValue();
        asciiBox.setValue(unicodeToAscii(text));
        mirrorCursor(unicodeBox, asciiBox);
        }, 300);

        const handleAscii = debounce((instance, changeObj) => {
            // Ignore internal updates caused by setValue
            if (changeObj.origin === "setValue") return;

            const text = asciiBox.getValue();
            unicodeBox.setValue(asciiToUnicode(text));
            mirrorCursor(asciiBox, unicodeBox);
        }, 300);


        unicodeBox.on("change", handleUnicode);
        asciiBox.on("change", handleAscii);

        // Highlight on focus
        unicodeBox.on("focus", () => {
        unicodeBox.getWrapperElement().classList.add("cm-editor-active");
        asciiBox.getWrapperElement().classList.remove("cm-editor-active");
        });

        asciiBox.on("focus", () => {
        asciiBox.getWrapperElement().classList.add("cm-editor-active");
        unicodeBox.getWrapperElement().classList.remove("cm-editor-active");
        });

        // Remove highlight if both lose focus (optional)
        [unicodeBox, asciiBox].forEach(editor => {
        editor.on("blur", () => {
            setTimeout(() => {
            if (
                !document.activeElement.closest(".CodeMirror")
            ) {
                editor.getWrapperElement().classList.remove("cm-editor-active");
            }
            }, 100);
        });
        });

        // Copy buttons
        async function copyToClipboard(target) {
            const text = (target === "unicodeEditor")
                ? unicodeBox.getValue()
                : asciiBox.getValue();

            try {
                await navigator.clipboard.writeText(text);
            } catch (err) {
                console.error("Failed to copy:", err);
                alert("Failed to copy");    
            }
        }

        //copy buttons
        document.querySelectorAll(".copy-btn").forEach(btn => {
            btn.addEventListener("click", () => {
                const target = btn.getAttribute("data-target");
                copyToClipboard(target);
                btn.textContent = "Copied!";
                setTimeout(() => btn.textContent = "Copy", 1200);
            });
        });

        //geneate zip button and //form validation for editor to check for empty submission
        document.getElementById("treeForm").addEventListener("submit", function (e) {
            const unicodetext = unicodeBox.getValue();
            if (unicodetext.trim()){
                document.getElementById("unicodeHidden").value = unicodetext;
            }
            else{
                e.preventDefault(); // stop form submission
                alert("Please input a valid tree into the editor.")
            }
        });
    });
</script>
    
{% endblock %}
